<!DOCTYPE html>
<html>
  <head>
    <title>Firebase</title>
    <script defer src="/__/firebase/4.1.3/firebase-app.js"></script>
    <script defer src="/__/firebase/4.1.3/firebase-database.js"></script>
    <script defer src="/__/firebase/init.js"></script>
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <script src="jquery-3.2.1.js"></script>
	<!-- <script src="./index.js" type="text/javascript"></script> -->
  </head>
  
  
  <body onload="run()">
    
    <h1>Status</h1>
    <div class="box">
    	<h2>Pod 1:</h2>
    	<p id="pod1-broadcaster"></p>
    	<p id="pod1-headset-bridge"></p>
    	<p id="pod1-lighting"></p>
    	<p id="pod1-sound"></p>
    </div>
    
    <div class="box">
    	<h2>Pod 2:</h2>
    	<p>example text</p>
    </div>
    <div class="box">
    	<h2>Pod 3:</h2>
    	<p>example text</p>
    </div>
    <div class="box">
    	<h2>Pod 4:</h2>
    	<p>example text</p>
    </div>
    <div class="box">
    	<h2>Pod 5:</h2>
    	<p>example text</p>
    </div>
    <hr>
    <h1>Shutdown</h1>
    <div class="box" id="shutdown_box">  
		<p>Click to begin shutdown, then wait for confirmation message. </p>
		<button id="offbutton" onclick="offButton()">Begin shutdown</button>
		<div class="loader" id="pending"></div>
		<div id="response">Shutdown procedure successful. Click to confirm power off.</div>
		<div id="fail">Shutdown procedure unsuccessful.</div>
		<button id="poweroff" onclick="poweroff()">Confirm power off</button>
    </div>    
    

    
    <script>
    	
    	function run() {
    	
    		var pod1 = firebase.database().ref('installations/holter/ui/pod-1');
    	
//     	    pod1.once('value').then(function (snap) {
// 				snap.forEach(function(childsnap) {
// 				
// 					var div = "#pod1-" + childsnap.key; 
//     	
//     				if (snap.val() == true) {
//     					$(div).css({ 'color' : '#4CAF50' }).text("✔ " + childsnap.key + ": on");
//     				}
//     			
//     				else {
//     					$(div).css({ 'color' : 'red' }).text("✘ " + childsnap.key + ": off");
//     				}
// 				});
// 			});
    	
    		//toggle status  between on/off
    		pod1.on('child_changed', function(snap) {
    			var div = "#pod1-" + snap.key; 
    	
    			if (snap.val() == true) {
    				$(div).css({ 'color' : '#4CAF50' }).text("✔ " + snap.key + ": on");
    			}
    			
    			else {
    				$(div).css({ 'color' : 'red' }).text("✘ " + snap.key + ": off");
    			}
    		});
			
			//pod-1: toggle shutdown message for one pod. 
			 pod1.child('shutdown').on("value", function(snap) {
				if (snap.val() == true) {
					$("#response").show(); 
					$("#poweroff").show();
					$("#pending").hide();
					document.getElementById("poweroff").scrollIntoView();		
				}
			 });
   		 }
   		  		 
    	// Set off button to true, disable button, show loading image
    	function offButton() {
    		var ui = firebase.database().ref('installations/holter/ui');
    		$("#pending").show();
    		document.getElementById("pending").scrollIntoView();
			ui.child('button01_off').set(true);
			$("#offbutton").prop('disabled', true);
		}
		
		// Set power button to true, disable button
		function poweroff() {
			var ui = firebase.database().ref('installations/holter/ui');
			ui.child('button02_power').set(true);
			$("#poweroff").prop('disabled', true);
		}
		
    </script> 
  </body>
</html>
